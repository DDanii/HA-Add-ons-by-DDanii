#!/usr/bin/bashio

ENV_FILE=/container/environment/50-homeassistant/config.yaml

mkdir -p /container/environment/50-homeassistant

rm -f "$ENV_FILE"
touch "$ENV_FILE"
JSONSOURCE="/data/options.json"
mapfile -t arr < <(jq -r 'keys[]' "${JSONSOURCE}")
for KEY in "${arr[@]}"; do
    VALUE=$(bashio::config "$KEY")
    echo "$KEY: $VALUE" >> "$ENV_FILE"
    if "$KEY" -eq "PHPLDAPADMIN_HTTPS_CRT_FILENAME" or "$KEY" -eq "PHPLDAPADMIN_HTTPS_KEY_FILENAME"; then
        ln -s "/ssl/$VALUE" "/container/service/phpldapadmin/assets/apache2/certs/$VALUE"
    fi
done

/container/tool/run2